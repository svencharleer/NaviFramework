<html>
  <head>
    <title>Navi Framework Testbed</title>
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <link rel="stylesheet" href="css/naviFramework.css">
	<script type="text/javascript" src="js/3rdParty/paper.js"></script>
	<script type="text/javascript" src="js/3rdParty/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="js/magictouch.js"></script>
	
	<script type="text/javascript" src="js/NaviFramework/naviFramework_UI.js"></script>
	<script type="text/javascript" src="js/NaviFramework/naviFramework_Events.js"></script>
	<script type="text/javascript" src="js/NaviFramework/naviFramework_Animations.js"></script>
	<script type="text/javascript" src="js/NaviFramework/naviComponent_Animatable.js"></script>
	<script type="text/javascript" src="js/NaviFramework/naviComponent_Group.js"></script>
	<script type="text/javascript" src="js/NaviFramework/naviComponent_Renderable.js"></script>
	<script type="text/javascript" src="js/NaviFramework/naviComponent_Renderable_Image.js"></script>
	<script type="text/javascript" src="js/NaviFramework/naviComponent_Renderable_Square.js"></script>
	<script type="text/javascript" src="js/NaviFramework/naviComponent_Renderable_Text.js"></script>
	<script type="text/javascript" src="js/NaviFramework/naviComponent_Touchable.js"></script>
	<script type="text/javascript" src="js/NaviFramework/naviObject_Scene.js"></script>
	<script type="text/javascript" src="js/NaviLearnScape/navi_CustomBadge.js"></script>
	<script type="text/javascript" src="js/NaviLearnScape/navi_CustomMenuItem.js"></script>
	<script type="text/javascript" src="js/NaviLearnScape/navi_CustomMenu.js"></script>
	<script type="text/javascript" src="js/NaviLearnScape/navi_CustomScene_Badges.js"></script>
	<script type="text/javascript" src="js/NaviLearnScape/navi_CustomTile.js"></script>
	<script type="text/javascript" src="js/NaviLearnScape/navi_CustomBackground.js"></script>
	<script type="text/javascript" src="js/NaviLearnScape/navi_CustomTests.js"></script>


	<script type="text/javascript">


var timer;
var updateStarted = false;
var updateLetGoStarted = false;
var updateMovedStarted = false;
var touches = [];
var touchesLetGo = [];
var touchesMoved = [];

function update() {
	if (updateStarted) return;
	updateStarted = true;
	var i, len = touches.length;
	for (i=0; i<len; i++) {
		fw.onFingerHits({x:touches[i].pageX, y:touches[i].pageY}, touches[i].identifier);
	}
	updateMoved();
	updateLetGo();
	touches = [];
	updateStarted = false;
	fw.onFrame();
}

function updateMoved() {
	if(updateMovedStarted) return;
	updateMovedStarted = true;
	var finger = touchesMoved.shift();
	while(finger != null)
	{

			fw.onFingerMoved({x:finger.pageX, y:finger.pageY}, finger.identifier);
			finger = touchesMoved.shift();
	}
	updateMovedStarted = false;
}

function updateLetGo() {
	if(updateLetGoStarted) return;
	updateLetGoStarted = true;
	var finger = touchesLetGo.shift();
	while(finger != null)
	{
			fw.onFingerLetGo(finger.identifier);
			finger = touchesLetGo.shift();
	}
	updateLetGoStarted = false;
}

function ol() {
	var body = document;
	fw.init();

	var scene;
	var menuItems = [{name:"menuBadges", text:"Badges", events:{mouseDownEvent: function(point, obj){scene = new BadgeScene();scene.init();}}}, {name:"menuStudents", text:"Students", events:{mouseDownEvent: function(point, obj){scene.exit();}}},{name:"menuSettings", text:"Settings", events:{}}];
	//var background = new Background("background", {x:fw.view.size.width/2, y:fw.view.size.height/2}, {w:fw.view.size.width,h:fw.view.size.height},0, "background_png");
	var objects = [new Menu("menu", {x:-200, y:0}, menuItems), tile1, tile2,new MenuItem("menuTest", "Test Menu Item", {x:15,y:50}, {})];
	//fw.drawBackgroundItem();

	fw.addObjectsToDocument(objects);
	
	
	timer = setInterval(update, 15);

	body.addEventListener('touchend', function() {
		touchesLetGo = touchesLetGo.concat(event.changedTouches);	
		
	});
	body.addEventListener('touchmove', function(event) {
	  	event.preventDefault();
	  	touchesMoved = event.changedTouches;

	});
	body.addEventListener('touchstart', function(event) {
	  	console.log('start');
	  	touches = event.targetTouches;
	  	
	 });

	
};

</script>

</head>
<body onload="ol()">

<object id="tuio" type="application/x-tuio">Plugin FAILED to load</object>
<div id="staticImageStore" style="display:none">
	<img src="img/background.png" id="background_png"/>
</div>
<div id="imageStore" style="display:none"></div>
</body>
</html>